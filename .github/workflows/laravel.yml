name: Laravel

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  # laravel-tests:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: shivammathur/setup-php@15c43e89cdef867065b0213be354c2841860869e
  #       with:
  #         php-version: "8.0"
  #     - uses: actions/checkout@v4
  #     - name: Copy .env
  #       run: php -r "file_exists('.env') || copy('.env.example', '.env');"
  #     - name: Install Dependencies
  #       run: composer install -q --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist
  #     - name: Generate key
  #       run: php artisan key:generate
  #     - name: Directory Permissions
  #       run: chmod -R 777 storage bootstrap/cache
  #     - name: Create Database
  #       run: |
  #         mkdir -p database
  #         touch database/database.sqlite
  #     - name: Execute tests (Unit and Feature tests) via PHPUnit/Pest
  #       env:
  #         DB_CONNECTION: sqlite
  #         DB_DATABASE: database/database.sqlite
  #       run: php artisan test
  deploy-app:
    runs-on: ubuntu-latest
    steps:
      - name: ssh-pipeline
        # You may pin to the exact commit or the version.
        # uses: cross-the-world/ssh-pipeline@7f022867934a210af826af99ef80d96f03a094d5
        uses: cross-the-world/ssh-pipeline@v1.2.0
        with:
          # ssh remote host
          host: ${{ secrets.SSH_HOST }}
          # ssh remote port
          # port: # optional, default is 22
          # ssh remote user
          user: ${{ secrets.SSH_USER }}
          # content of ssh private key. ex raw content of ~/.ssh/id_rsa
          key: ${{ secrets.SSH_PUB_KEY }}
          # ssh remote password
          # pass: # optional
          # connection timeout to remote host
          # connect_timeout: # optional, default is 30s
          # execute commands on ssh
          script: "cd ~/gestion_material/back && git pull && composer install && sail up -d && sail artisan migrate"
